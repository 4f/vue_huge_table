(function(t){function e(e){for(var n,o,r=e[0],l=e[1],u=e[2],h=0,f=[];h<r.length;h++)o=r[h],a[o]&&f.push(a[o][0]),a[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);c&&c(e);while(f.length)f.shift()();return s.push.apply(s,u||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,r=1;r<i.length;r++){var l=i[r];0!==a[l]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},a={app:0},s=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var c=l;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"3a98":function(t,e,i){"use strict";var n=i("3b21"),a=i.n(n);a.a},"3a9d":function(t,e,i){},"3b21":function(t,e,i){},"43f0":function(t,e,i){},"54d1":function(t,e,i){"use strict";var n=i("3a9d"),a=i.n(n);a.a},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("097d");var n=i("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("Table",{attrs:{offsetRow:11111,offsetColumn:11113}})],1)},s=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"first"},[i("input",{attrs:{type:"submit",disabled:t.isDisableSave,value:"Save"},on:{click:t.save}})]),i("div",{staticClass:"middle flex11"},[i("div",{ref:"wrapTable",staticClass:"wrap-table",on:{"&wheel":function(e){return t.onscroll(e)}}},[i("table",{ref:"table",class:t.tableClass,style:{width:t.tableWidth+"px"}},[i("thead",[i("th",{staticClass:"square",on:{click:t.moveStart,dblclick:t.moveEnd}},[t._v("##")]),t._l(t.columns,function(e){return i("th",{key:e,staticClass:"v-ruler",domProps:{textContent:t._s(e)}})}),i("th",{staticClass:"column-blank"},[t._v("--")])],2),i("tbody",[t._l(t.rows,function(e){return i("tr",{key:e,staticClass:"not-blank"},[i("td",{staticClass:"h-ruler",domProps:{textContent:t._s(e)}}),t._l(t.columns,function(n){return i("td",{key:n+"."+e,staticClass:"usual",class:{changed:t.isChanged(n,e)}},[i("div",{staticClass:"wrap-flex"},[i("input",{staticClass:"checkbox",attrs:{type:"checkbox"},domProps:{checked:t.values[n][e].checked},on:{input:function(i){t.oncheckbox(n,e,i)}}}),i("input",{staticClass:"number",attrs:{disabled:t.values[n][e].checked,type:"number"},domProps:{value:t.values[n][e].value},on:{input:function(i){t.onnumber(n,e,i)}}})])])}),i("td",{staticClass:"column-blank"})],2)}),i("tr",{staticClass:"blank"},[i("td",{staticClass:"h-ruler"},[t._v("--")]),t._l(t.columns,function(t){return i("td",{key:t,staticClass:"usual"})}),i("td",{staticClass:"column-blank"})],2)],2)])]),i("div",{staticClass:"wrap-right-scroll"},[i("Scroll",t._b({},"Scroll",t.propsRightScroll,!1))],1)]),i("div",{staticClass:"wrap-bottom-scroll"},[i("Scroll",t._b({},"Scroll",t.propsBottomScroll,!1)),i("div",{staticClass:"square",on:{click:t.moveEnd,dblclick:t.moveStart}})],1)])},r=[],l=(i("ac6a"),i("456d"),i("c93e")),u=(i("c5f6"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"scroll",on:{click:t.click}},[i("div",{staticClass:"thumb",style:t.thumbStyle})])}),c=[],h={name:"Scroll",computed:{thumbOffset:function(){return 100*this.offsetCount/this.overallCount+"%"},thumbWidth:function(){return this.showedCount/this.overallCount+"%"},thumbStyle:function(){return this[this.side+"Style"]},rightStyle:function(){return{top:this.thumbOffset,height:this.thumbWidth}},bottomStyle:function(){return{left:this.thumbOffset,width:this.thumbWidth}},isBottom:function(){return"bottom"===this.side}},props:{showedCount:{type:Number,required:!0},overallCount:{type:Number,required:!0},offsetCount:{type:Number,required:!0},move:{type:Function,required:!0},side:{type:String,required:!0,validator:function(t){return-1!==["right","bottom"].indexOf(t)}}},methods:{onscroll:function(t){},click:function(t){this.move(this[this.side+"NewFirstCell"](t))},bottomNewFirstCell:function(t){return Math.round(this.overallCount*t.offsetX/t.target.offsetWidth)},rightNewFirstCell:function(t){return Math.round(this.overallCount*t.offsetY/t.target.offsetHeight)}}},f=h,d=(i("3a98"),i("2877")),v=Object(d["a"])(f,u,c,!1,null,"5a3868a2",null);v.options.__file="scroll.vue";var p=v.exports,m=(i("84b4"),i("c665")),b=i("aa9a"),w=i("a322"),y=function(){function t(e){var i=e.gridX,n=e.gridY;Object(m["a"])(this,t),this.gridPoint={x:i,y:n},this.id=t.getId({gridX:i,gridY:n}),this.next=null,this.prev=null,this.data=[],this.isLoaded=!1,this.indexView=0}return Object(b["a"])(t,null,[{key:"init",value:function(t){return this.overallSize=t,this.first=new this(0,0),this.last=this.first,this.hashdata={},this}},{key:"getId",value:function(t){var e=t.gridX,i=t.gridY;return"".concat(e,"-").concat(i)}},{key:"getCell",value:function(t){var e=this.getId(this.getGridCoordinates(t)),i=this.hashdata[e];if(i){var n=this.getCoordinatesInGrid(t),a=n.localX,s=n.localY;return i._getCell({localX:a,localY:s})}return null}},{key:"getGridCoordinates",value:function(e){var i=e.x,n=e.y;return{gridX:Math.trunc(i/t.DIMENSION.w),gridY:Math.trunc(n/t.DIMENSION.h)}}},{key:"getCoordinatesInGrid",value:function(e){var i=e.x,n=e.y;return{localX:i%t.DIMENSION.w,localY:n%t.DIMENSION.h}}},{key:"increaseSize",value:function(){if(this.size++,this.size>this.MAX_SIZE){var t=this.first.next;delete this.hashdata[this.first.id],this.first=t,this.hashdata=Object(l["a"])({},this.hashdata)}}},{key:"isInCache",value:function(t){var e=this.getId(this.getGridCoordinates(t));return!!this.hashdata[e]}},{key:"getViewGridIds",value:function(t){var e=t.offset,i=e.x,n=e.y,a=t.viewSize,s=a.w,o=a.h,r={},l=Math.min(i+s+this.PRELOAD_TRESHHOLD,this.overallSize.w),u=Math.min(n+o+this.PRELOAD_TRESHHOLD,this.overallSize.h),c=[];for(r.x=Math.max(0,i-this.PRELOAD_TRESHHOLD);r.x<l;r.x+=this.DIMENSION.w){for(r.y=Math.max(0,n-this.PRELOAD_TRESHHOLD);r.y<u;r.y+=this.DIMENSION.h)c.push(new this(this.getGridCoordinates(r)));r.y=u,c.push(new this(this.getGridCoordinates(r)))}for(r={x:l,y:u},r.y=Math.max(0,n-this.PRELOAD_TRESHHOLD);r.y<u;r.y+=this.DIMENSION.h)c.push(new this(this.getGridCoordinates(r)));return c.push(new this(this.getGridCoordinates(r))),c}}]),Object(b["a"])(t,[{key:"getCell",value:function(e){if(!this.isLoaded)return null;var i=t.getCoordinatesInGrid(e),n=i.localX,a=i.localY;return this.indexView+t.HOT_SIZE<t.indexLastView&&(this.indexView=++t.indexLastView),this.data[n][a]}},{key:"_getCell",value:function(e){var i=e.localX,n=e.localY;return this.isLoaded?(this.indexView+t.HOT_SIZE<t.indexLastView&&(this.indexView=++t.indexLastView),this.data[i][n]):null}},{key:"isQuered",value:function(){return!!t.hashdata[this.id]}},{key:"putToQuery",value:function(){t.hashdata[this.id]=this,this.prev=t.last,t.last.next=this,this.indexView=++t.indexLastView,t.increaseSize()}},{key:"getFirstPoint",value:function(){return{x:this.gridPoint.x*t.DIMENSION.w,y:this.gridPoint.y*t.DIMENSION.h}}},{key:"rect",value:function(){return Object(l["a"])({},this.getFirstPoint(),t.DIMENSION)}},{key:"setLoaded",value:function(t){var e=t.array;this.data=e,this.isLoaded=!0}}]),t}();Object(w["a"])(y,"DIMENSION",{w:Math.pow(2,5),h:Math.pow(2,5)}),Object(w["a"])(y,"MAX_SIZE",128),Object(w["a"])(y,"HOT_SIZE",32),Object(w["a"])(y,"PRELOAD_TRESHHOLD",8),Object(w["a"])(y,"indexLastView",0),Object(w["a"])(y,"first",null),Object(w["a"])(y,"last",null),Object(w["a"])(y,"hashdata",{}),Object(w["a"])(y,"size",0),Object(w["a"])(y,"overallSize",{w:0,h:0});var S=y,g=function(){return new Promise(function(t,e){setTimeout(function(){t({data:{w:4e4,h:4e4}})},500)})};function C(t){var e=t.x,i=t.y,n=t.w,a=t.h;return new Promise(function(t,s){setTimeout(function(){try{for(var o=[],r=0;r<n;r++){o[r]=[];for(var l=0;l<a;l++)o[r][l]=Math.round(1e3*Math.random())}t({data:{x:e,y:i,array:o}})}catch(t){s("error")}},500)})}i("7f7f");var O=i("2f62");n["a"].use(O["a"]);var x=new O["a"].Store({strict:!1}),z=function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=n>0?"".concat(i,"_").concat(n):i,s=e.state[a];return s?t(e,i,n+1):a},k=function(t,e,i){t=t||x;var n=z(t,i);return t.registerModule(n,e),{namespace:n,state:function(e){return t.state[n][e]},getter:function(e){return t.getters["".concat(n,"/").concat(e)]},commit:function(e,i){t.commit("".concat(n,"/").concat(e),i)},dispatch:function(e,i){t.dispatch("".concat(n,"/").concat(e),i)},destroy:function(){t.unregisterModule(n)},mapState:function(t){return Object(O["e"])(n,t)},mapActions:function(t){return Object(O["b"])(n,t)},mapGetters:function(t){return Object(O["c"])(n,t)},mapMutations:function(t){return Object(O["d"])(n,t)}}},V=x,_={namespaced:!0};function I(t){for(var e=t.offset,i=t.viewSize,a=t.values,s=t.changedValues,o=e.x+1,r=i.w+e.x;o<=r;o++){void 0===a[o]&&n["a"].set(a,o,{});for(var u=e.y+1,c=i.h+e.y;u<=c;u++)if(void 0===a[o][u]||null===a[o][u].value){var h={};s[o]&&s[o][u]&&(h=Object(l["a"])({},s[o][u])),void 0===h.value&&(h.value=S.getCell({x:o,y:u})),h.checked=h.checked||!1,n["a"].set(a[o],u,h)}}}_.state=function(){return{offset:{x:0,y:0},viewSize:{w:9,h:9},loading:!1,errorRequest:!1,overallSize:{w:0,h:0},changedValues:{},values:{}}},_.getters={},_.actions={getOverallSize:function(t){var e=t.commit,i=t.dispatch;e("loading",!0),g().then(function(t){var n=t.data;e("setOverallSize",n),i("checkViewInCache")}).catch(function(t){return e("errorRequest",t)}).finally(function(){return e("loading",!1)})},load:function(t,e){var i=t.commit;i("loading",!0),C(e.rect()).then(function(t){var n=t.data;return i("updateCache",{grid:e,data:n})}).catch(function(t){return i("errorRequest",t)}).finally(function(){return i("loading",!1)})},setOverallSize:function(t,e){var i=t.commit,n=t.dispatch;i("setOverallSize",e),n("checkViewInCache")},setOffset:function(t,e){var i=t.commit,n=t.dispatch;i("setOffset",e),n("checkViewInCache")},setViewSize:function(t,e){var i=t.commit,n=t.dispatch;i("setViewSize",e),n("checkViewInCache")},checkViewInCache:function(t){var e=t.state,i=e.overallSize,n=e.viewSize,a=e.offset,s=t.dispatch;if(!i.w&&!i.h)return null;var o=S.getViewGridIds({viewSize:n,offset:a});console.log(o),o.forEach(function(t){t.isQuered()||(t.putToQuery(),s("load",t),console.log(t))})}},_.mutations={loading:function(t,e){t.loading=e},errorRequest:function(t,e){t.errorRequest=e},initValues:function(t){I(t)},setOverallSize:function(t,e){S.init(e),t.overallSize=e,I(t)},setOffset:function(t,e){var i=e.x,n=e.y;void 0!==n&&(t.offset.y=Math.max(0,Math.min(n,t.overallSize.h-t.viewSize.h))),void 0!==i&&(t.offset.x=Math.max(0,Math.min(i,t.overallSize.w-t.viewSize.w))),I(t)},setViewSize:function(t,e){var i=e.w,n=e.h;void 0!==i&&(t.viewSize.w=i,0!==t.overallSize.w&&i+t.offset.x>t.overallSize.w&&(t.offset.x=t.overallSize.w-i)),void 0!==n&&(t.viewSize.h=n,0!==t.overallSize.h&&n+t.offset.y>t.overallSize.h&&(t.offset.y=t.overallSize.h-n)),I(t)},updateCache:function(t,e){var i=e.grid,n=e.data;i.setLoaded(n),I(t)},removeChangedValue:function(t,e){var i=t.changedValues,n=t.values,a=e.x,s=e.y,o=e.field,r=i[a];r&&r[s]&&r[s][o]&&(delete r[s][o],Object.keys(r[s]).length||delete r[s],Object.keys(r).length||delete i[a],n[a][s].checked=!1)},setChangedValue:function(t,e){var i=t.changedValues,a=t.values,s=e.x,o=e.y,r=e.field,l=e.value;void 0===i[s]?n["a"].set(i,s,Object(w["a"])({},o,Object(w["a"])({},r,l))):void 0===i[s][o]?n["a"].set(i[s],o,Object(w["a"])({},r,l)):n["a"].set(i[s][o],r,l),a[s][o][r]=l}};var M=function(t){return k(t,_,"tableStore")},j=M(null),E={name:"Table",data:function(){return{tableWidth:660}},props:{offsetRow:{type:Number,default:1},offsetColumn:{type:Number,default:1}},computed:Object(l["a"])({},j.mapState(["values","changedValues","counterCache","overallSize","offset","viewSize"]),{rows:function(){for(var t=this.viewSize.h,e=this.offset.y,i=new Array(t),n=0;n<t;)i[n]=++n+e;return i},columns:function(){for(var t=this.viewSize.w,e=this.offset.x,i=new Array(t),n=0;n<t;)i[n]=++n+e;return i},isDisableSave:function(){return!Object.keys(this.changedValues).length},tableClass:function(){return{top:0===this.offset.y,bottom:this.offset.y+this.viewSize.h>=this.overallSize.h,right:this.offset.x+this.viewSize.w>=this.overallSize.w,left:0===this.offset.x}},propsRightScroll:function(){var t=this;return{side:"right",showedCount:this.viewSize.h,overallCount:this.overallSize.h,offsetCount:this.offset.y,move:function(e){return t.setOffset({y:e})}}},propsBottomScroll:function(){var t=this;return{class:"flex11",side:"bottom",showedCount:this.viewSize.w,overallCount:this.overallSize.w,offsetCount:this.offset.x,move:function(e){return t.setOffset({x:e})}}}}),methods:Object(l["a"])({},j.mapMutations(["initValues","setChangedValue","removeChangedValue"]),j.mapActions(["setOffset","setViewSize"]),{isChanged:function(t,e){var i=this.changedValues[t];return i&&i[e]},save:function(){console.log(JSON.stringify(this.changedValues),JSON.parse(JSON.stringify(this.changedValues)))},moveEnd:function(){this.setOffset({x:this.overallSize.w,y:this.overallSize.h})},moveStart:function(){this.setOffset({x:0,y:0})},oncheckbox:function(t,e,i){var n=i.target.checked;this[n?"setChangedValue":"removeChangedValue"]({x:t,y:e,field:"checked",value:n})},onnumber:function(t,e,i){var n=S.getCell({x:t,y:e}),a=+i.target.value||n;this[a===n?"removeChangedValue":"setChangedValue"]({x:t,y:e,field:"value",value:a})},onscroll:function(t){var e=100,i=Math.round(t.deltaY/e)||1;this.setOffset(t.altKey?{x:this.offset.x+i}:{y:this.offset.y+i})},onresize:function(){this.setViewSize({w:this.computeColumnsCount(),h:this.computeRowsCount()}),this.tableWidth=this.computeTableWidth()},computeRowsCount:function(){var t=this.$refs.table.querySelector("th"),e=this.$refs.table.querySelector("tr"),i=this.$refs.wrapTable.offsetHeight;return Math.floor((i-t.offsetHeight)/e.offsetHeight)},computeColumnsCount:function(){var t=this.$refs.table.querySelector("th"),e=t.nextElementSibling,i=this.$refs.wrapTable.offsetWidth;return Math.floor((i-t.offsetWidth)/e.offsetWidth)},computeTableWidth:function(){var t=this.$refs.table.querySelector("th"),e=t.nextElementSibling;return t.offsetWidth+e.offsetWidth*this.computeColumnsCount()}}),beforeCreate:function(){j.dispatch("getOverallSize"),j.commit("initValues")},mounted:function(){this.onresize(),this.setOffset({x:this.offsetColumn,y:this.offsetRow}),window.addEventListener("resize",this.onresize)},beforeDestroy:function(){j.destroy(),window.removeEventListener("resize",this.onresize)},components:{Scroll:p}},N=E,D=(i("54d1"),Object(d["a"])(N,o,r,!1,null,"001c80d4",null));D.options.__file="index.vue";var L=D.exports,R={name:"app",store:V,components:{Table:L}},T=R,P=(i("fffb"),Object(d["a"])(T,a,s,!1,null,null,null));P.options.__file="app.vue";var H=P.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(H)}}).$mount("#app")},fffb:function(t,e,i){"use strict";var n=i("43f0"),a=i.n(n);a.a}});
//# sourceMappingURL=app.a52ba6a8.js.map